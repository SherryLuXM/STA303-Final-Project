---
title: "Mingar Customer and Product Report"
subtitle: "By Data Analytics Inc."
author: "Rumteen Taheri Dolatabdi
Antony Dudnikov
Xiaoman Lu
Opal Ashok Patil"
date: "07/04/2022"
lang: "en"
output:
 pdf_document:
  template: template.tex
  toc: true
  toc_depth: 2
titlepage: true
titlepage-color: "002A5C"
titlepage-text-color: "FFFFFF"
titlepage-rule-color: "FFFFFF"
titlepage-rule-height: 2
urlcolor: blue
linkcolor: black
---

\listoffigures

\newpage

# Executive Summary

\newpage

# Consultant Profiles

\newpage
# Code

```{r setup, message=FALSE}
library(tidyverse)
library(polite)
library(rvest)
library(haven)
library(cancensus)
```

```{r}
# webscraping
url <- "https://fitnesstrackerinfohub.netlify.app"

target <- bow(url,
              user_agent = "sherryxiaoman.lu@mail.utoronto.ca for STA303/1002 final project",
              force = TRUE)
target

html <- scrape(target)

device_data <- html %>% 
  html_elements("table") %>% 
  html_table()

# load postal code data
dataset = read_sav("pccfNat_fccpNat_082021sav.sav")

postcode <- dataset %>% 
  select(PC, CSDuid)

# Load and tidy income data from Canadian census
options(cancensus.api_key = "CensusMapper_c35605992b233a54f504b09dcd8d5687",
        cancensus.cache_path = "cache")

regions <- list_census_regions(dataset = "CA21")

regions_filtered <-  regions %>% 
  filter(level == "CSD") %>% # CSD are Census Subdivision; it is a geographic level
  as_census_region_list()

census_data_csd <- get_census(dataset='CA21', regions = regions_filtered,
                          vectors=c("v_CA21_2397"),
                          level='CSD', geo_format = "sf")

## Simplify to only needed variables
median_income <- census_data_csd %>% 
  as_tibble() %>% 
  select(CSDuid = GeoUID, contains("median"), Population) %>% 
  mutate(CSDuid = parse_number(CSDuid)) %>% 
  rename(hhld_median_inc = 2)
```
